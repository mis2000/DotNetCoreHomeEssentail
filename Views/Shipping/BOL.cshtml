@model IEnumerable<MySqlBasicCore.Models.Bol_1_ViewModel>
@{
    ViewBag.Title = "Home Page";
}


<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-title">
                    <h3>Home</h3>
                </div>
                <div class="ibox-content">
                    <table class="table table-striped table-bordered table-hover dataTables-example" id="tbl">
                        <thead>
                            <tr>
                                <th>Action</th>
                                <th>HE_WH</th>
                                <th>BOL_NO</th>
                                <th>Order_No</th>
                                <th>PO_No</th>
                                <th>Date</th>
                                <th>Name</th>
                                <th>Sname</th>
                                <th>Adrs1</th>
                                <th>Adrs2</th>
                                <th>Adrs3</th>
                                <th>Zip</th>
                                <th>Lctn</th>

                                <th>CarrierName</th>
                                <th>CarrierPhone</th>
                                <th>PkupDate</th>
                                <th>PkupTime</th>

                                <th>Canceldate</th>
                                <th>Scac</th>
                                <th>Frght_terms</th>
                                <th>Ttl_pkgs</th>
                                <th>TtlValue</th>
                                <th>Ttl_weight</th>
                                <th>Pro_no</th>
                                <th>Ref</th>



                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var row in Model)
                            {
                                <tr>
                                    <th>
                                        <a href='@Url.Action("BOLDetail", "Shipping", new { id = row.bol1_no })'>   Detail</a>
                                    </th>
                                    <td>@row.bol1_HE_WH</td>
                                    <td>@row.bol1_no</td>
                                    <td>@row.bol1_order_no</td>
                                    <td>@row.bol1_PO_No</td>
                                    <td>@row.bol1_date</td>
                                    <td>@row.bol1_name</td>
                                    <td>@row.bol1_sname</td>
                                    <td>@row.bol1_adrs1</td>
                                    <td>@row.bol1_adrs2</td>
                                    <td>@row.bol1_adrs3</td>
                                    <td>@row.bol1_zip</td>
                                    <td>@row.bol1_Lctn</td>

                                    <td>

                                        <input type="text" class="form-control" value="@row.bol1_carrierName" 
                                               onchange="updateBolDetail('@row.bol1_no','@row.bol1_order_no','bol1_carrierName')" />


                                    </td>
                                    <td>
                                        <input type="text" class="form-control" value="@row.bol1_carrierPhone"
                                               onchange="updateBolDetail('@row.bol1_no','@row.bol1_carrierPhone','bol1_carrierPhone')" />
                                    </td>
                                    <td>
                                        <div class="input-group date" style="width:150px">
                                            <input type="text" class="form-control" 
                                                   id="@(row.bol1_no+"_"+@row.bol1_order_no+"_date")"
                                                    onchange="updateBolDetail('@row.bol1_no','@row.bol1_order_no','bol1_PkupDate')"
                                                   value="@row.bol1_PkupDate?.ToString("MM/dd/yyyy")">
                                            <span class="input-group-addon">
                                                <i class="fa fa-calendar"></i>
                                            </span>
                                        </div>

                                    </td>
                                    <td style="min-width:150px">
                                        <div class="input-group clockpicker" data-autoclose="true">
                                            <input type="text" class="form-control"  
                                                   id="@(row.bol1_no+"_"+@row.bol1_order_no+"_time")"
                                                    onchange="updateBolDetail('@row.bol1_no','@row.bol1_order_no','bol1_pkupTime')"
                                                   value="@row.bol1_pkupTime">
                                            <span class="input-group-addon">
                                                <span class="fa fa-clock-o"></span>
                                            </span>
                                        </div>

                                    </td>

                                    <td>@row.bol1_CancelDate</td>
                                    <td>@row.bol1_scac</td>
                                    <td>@row.bol1_frght_terms</td>
                                    <td>@row.bol1_ttl_pkgs</td>
                                    <td>@row.bol1_ttlValue</td>
                                    <td>@row.bol1_ttl_weight</td>
                                    <td>@row.bol1_pro_no</td>
                                    <td>@row.bol1_ref</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>
@section Styles {
    <environment names="Development,Staging,Production">
        <link rel="stylesheet" href="~/lib/dataTables/datatables.min.css" />
        <link rel="stylesheet" href="~/lib/sweetalert/dist/sweetalert.css" />
        <link href="~/css/plugins/datapicker/datepicker3.css" rel="stylesheet" />
        <link href="~/css/plugins/clockpicker/clockpicker.css" rel="stylesheet" />
    </environment>
}

@section Scripts {
    <environment names="Development,Staging,Production">
        <script src="~/lib/dataTables/datatables.min.js"></script>
        <script src="~/lib/dataTables/dataTables.bootstrap4.min.js"></script>
        <script src="~/lib/sweetalert/dist/sweetalert.min.js"></script>
        <script src="~/js/plugins/datapicker/bootstrap-datepicker.js"></script>
        <script src="~/js/plugins/clockpicker/clockpicker.js"></script>

    </environment>

    <script type="text/javascript">
        $(document).ready(function () {

              var mem = $('.input-group.date').datepicker({
                todayBtn: "linked",
                keyboardNavigation: false,
                forceParse: false,
                calendarWeeks: true,
                autoclose: true,
                startDate: new Date(),
                endDate: (addDays(new Date(),60))

            });
			
            $('.clockpicker').clockpicker();



             $('#tbl').DataTable({
                dom: '<"html5buttons"B>lTfgitp',
                buttons: [
                    { extend: 'copy' },
                    { extend: 'csv' },
                    { extend: 'excel', title: 'ExampleFile' },
                    { extend: 'pdf', title: 'ExampleFile' },

                    {
                        extend: 'print',
                        customize: function (win) {
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                .addClass('compact')
                                .css('font-size', 'inherit');
                        }
                    }
                 ],
                 "scrollY": "" + (window.outerHeight - 350) + "px",
                 "scrollX": "" + (window.outerWidth - 300) + "px",
          });
        });

        function updateBolDetail( bol1_no , bol1_order_no , column ) {
            if (column=="bol1_pkupTime") {
                var checkTime = ($("#" + bol1_no + "_" + bol1_order_no + "_time").val());
                var checkTimes = checkTime.split(":");
                if (checkTimes.length>0) {
                    if (Number( checkTimes[0]) < 7) {
                        swal("Time should be between 7AM(07:00) to 7PM(19:00)", "", "error");
                        return;
                    }
                    if (Number( checkTimes[0]) > 19) {
                        swal("Time should be between 7AM(07:00) to 7PM(19:00)", "", "error");
                        return;
                    }

                    if (Number( checkTimes[0]) == 19 && Number( checkTimes[1]) > 0 ) {
                        swal("Time should be between 7AM(07:00) to 7PM(19:00)", "", "error");
                        return;
                    }
                }
                
            }



        var data = { 'bol1_no': bol1_no, 'bol1_order_no':bol1_order_no};
        //column
        data.column =column;
       
        if(column=="bol1_PkupDate")
        {
         
         data[column] =  ($("#"+bol1_no+"_"+bol1_order_no+"_date").val());
        }
        else if (column=="bol1_pkupTime")
        {
        console.log("time");
        data[column] =  ($("#"+bol1_no+"_"+bol1_order_no+"_time").val());
        }
        else
        {
         data[column] = $(event.target).val();
        }
        
        console.log(data);
             $.ajax({
                    url: "/Shipping/UpdateBolDetail",
                    type: "POST",
                    dataType: "json",
                    data: data,
                    success: function (data) {
                        if (data.Status=="1") {
                            swal(data.Message, "", "success")
                        }
                        else {
                            swal(data.Message, "", "error")
                        }
                    }
                })
        }

        function addDays(date, days) {
        var result = new Date(date);
        result.setDate(result.getDate() + days);
        return result;
       }

    </script>
}